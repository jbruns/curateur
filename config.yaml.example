# curateur configuration template
# Copy this file to config.yaml and customize each section as needed.

screenscraper:
  # ScreenScraper user credentials (required - obtain from screenscraper.fr)
  # Note: Developer credentials are hardcoded in the application
  user_id: ""
  user_password: ""

paths:
  # Root ROM directory (can be absolute or relative)
  # Purpose: Source directory containing ROM files to scrape
  roms: ./roms
  
  # Destination for downloaded media (must be writable)
  # Purpose: Media files organized by system/media_type/filename
  # Default: ./downloaded_media
  media: ./downloaded_media
  
  # Destination for gamelist.xml files (must be writable)
  # Purpose: Generated gamelist.xml per system, ES-DE compatible
  # Default: ./gamelists
  gamelists: ./gamelists
  
  # Path to ES-DE es_systems.xml (must exist and be readable)
  # Purpose: Defines systems, extensions, and ROM paths for scanning
  # Default: ./es_systems.xml
  es_systems: ./es_systems.xml

scraping:
  # System short names to scrape (e.g., ["nes","snes","psx"])
  # Purpose: Limits scraping to specific systems
  # Valid: ES-DE system short names from es_systems.xml
  # Default: [] (empty = all systems)
  systems: []
  
  # Media types to download
  # Purpose: Defines which media assets to download from ScreenScraper
  # Valid: covers, screenshots, titlescreens, marquees, 3dboxes, backcovers,
  #        fanart, manuals, miximages, physicalmedia, videos
  # Default: all types
  # Note: Order does not affect download priority
  media_types:
    - covers
    - screenshots
    - titlescreens
    - marquees
    - 3dboxes
    - backcovers
    - fanart
    - manuals
    - miximages
    - physicalmedia
    - videos
  
  # Region priority for media selection (lowercase ScreenScraper codes)
  # Purpose: Defines region preference when multiple media variants exist
  # Valid: us, wor (world), eu, jp, ss (ScreenScraper generic), and more
  # Default: [us, wor, eu, jp, ss]
  preferred_regions: [us, wor, eu, jp, ss]
  
  # Preferred metadata language (two-letter ISO 639-1 code)
  # Purpose: Language for game titles, descriptions, genres
  # Valid: en, fr, de, es, it, pt, ja, etc.
  # Default: en
  preferred_language: en
  
  # Hash algorithm for ROM and media file verification
  # Purpose: Algorithm used to calculate and compare file hashes
  # Valid: crc32 | md5 | sha1
  # Default: crc32
  # Note: Stored in gamelist.xml <hash> element for change detection
  hash_algorithm: crc32
  
  # Maximum file size (bytes) for hash calculation
  # Purpose: Skip hash calculation for files larger than this (performance)
  # Valid: Non-negative integer (0 = disabled, calculate all files)
  # Default: 1073741824 (1 GiB)
  # Note: Large ISO/CHD files may be slow to hash
  crc_size_limit: 1073741824
  
  # Minimum width/height (pixels) for image verification
  # Purpose: Reject images smaller than this dimension
  # Valid: Positive integer
  # Default: 50
  # Note: Prevents corrupt or placeholder images
  image_min_dimension: 50
  
  # Gamelist integrity threshold (fraction of ROMs that must match)
  # Purpose: Fail validation if match rate below this threshold
  # Valid: 0.0 - 1.0 (0.95 = 95%)
  # Default: 0.95
  # Note: Validation always performed; prompt if threshold not met
  gamelist_integrity_threshold: 0.95
  
  # Update policy for ROM scraping (hash-based detection)
  # Purpose: Determines when to fetch metadata based on ROM hash changes
  # Valid: always | changed_only | never
  # Default: changed_only
  # Behavior:
  #   - always: Fetch metadata for all ROMs regardless of hash match
  #   - changed_only: Fetch only when ROM hash differs from gamelist (default)
  #   - never: Skip all ROMs that exist in gamelist and filesystem
  update_policy: changed_only
  
  # Update metadata fields when ROM hash matches
  # Purpose: Allow metadata updates even when ROM unchanged
  # Valid: true | false
  # Default: true
  # Note: Only applies when update_policy is 'always'; respects merge_strategy
  update_metadata: true
  
  # Update media files when ROM hash matches
  # Purpose: Re-download/validate media even when ROM unchanged
  # Valid: true | false
  # Default: true
  # Note: Only applies when update_policy is 'always'; validates media hashes
  update_media: true
  
  # Metadata merge strategy for updates
  # Purpose: Controls field preservation during metadata updates
  # Valid: preserve_user_edits | overwrite_all
  # Default: preserve_user_edits
  # Behavior:
  #   - preserve_user_edits: Preserve all existing fields, update only scraped fields
  #   - overwrite_all: Replace scraped fields, preserve only user fields (favorite, playcount, etc.)
  merge_strategy: preserve_user_edits
  
  # Remove media files for disabled media types
  # Purpose: Clean up media when media_types list changes
  # Valid: true | false
  # Default: false
  # Note: Removes media types not in enabled media_types list
  clean_mismatched_media: false
  
  # Checkpoint interval (number of ROMs)
  # Purpose: Save progress periodically for resume capability
  # Valid: Non-negative integer (0 = disabled)
  # Default: 0 (disabled)
  # Note: Set to 50-100 for large collections, enables resume from interruption
  checkpoint_interval: 0
  
  # Name verification strictness
  # Purpose: How strictly to match game names during API verification
  # Valid: strict | normal | lenient | disabled
  # Default: normal
  # Note: strict=exact, normal=normalized, lenient=fuzzy, disabled=skip check
  name_verification: normal
  
  # Quota warning threshold
  # Purpose: Log warning when approaching API quota limits (daily requests or bad requests)
  # Valid: 0.0 - 1.0 (0.95 = warn at 95% usage)
  # Default: 0.95
  # Note: Warning logged once per session when threshold crossed for either quota type
  quota_warning_threshold: 0.95
  
  # Advanced: Rate limit override (use with caution)
  # Purpose: Override API-provided rate limits for advanced scenarios
  # Valid: true | false
  # Default: false
  # Warning: Cannot exceed API limits - will be capped with warning
  # Note: API limits are authoritative; overrides can only reduce limits safely
  rate_limit_override_enabled: false
  
  # Rate limit override values (only used if rate_limit_override_enabled=true)
  # Purpose: Manually specify rate limits (capped at API-provided limits)
  # Valid: max_workers (1-10), requests_per_minute (1-300), daily_quota (1000-50000)
  # Default: API-provided limits, or 1 worker/60 rpm/10000 daily if API doesn't provide
  # Behavior: Values exceeding API limits will be capped with warning logged
  #           Values below API limits will be honored with warning logged
  rate_limit_override:
    max_workers: 1                # Concurrent workers (typical API: 4, max: 8)
    requests_per_minute: 60       # API calls per minute (typical API: 120-300)
    daily_quota: 10000            # Daily API call limit (typical API: 20000)

media:
  # Skip download if media file already exists
  # Purpose: Avoid re-downloading existing media files
  # Valid: true | false
  # Default: true
  # Note: Checks file existence only, does not verify integrity
  skip_existing_media: true

api:
  # HTTP request timeout (seconds)
  # Purpose: Maximum time to wait for API responses
  # Valid: Positive number (15-60 recommended)
  # Default: 30
  request_timeout: 30
  
  # Maximum retry attempts for transient failures
  # Purpose: Auto-retry on network errors, 5xx responses
  # Valid: Non-negative integer (0-5 recommended)
  # Default: 3
  max_retries: 3
  
  # Base delay (seconds) for exponential backoff
  # Purpose: Initial wait time before retry (doubles each attempt)
  # Valid: Non-negative number (1-10 recommended)
  # Default: 5
  # Note: Retry delays: 5s, 10s, 20s with backoff_factor=2
  retry_backoff_seconds: 5

logging:
  # Logging level
  # Purpose: Controls verbosity of log output
  # Valid: DEBUG | INFO | WARNING | ERROR
  # Default: INFO
  # Note: DEBUG shows all operations, ERROR shows failures only
  level: INFO
  
  # Enable console logging
  # Purpose: Output logs to stdout/stderr
  # Valid: true | false
  # Default: true
  console: true
  
  # Optional log file path
  # Purpose: Write logs to file in addition to console
  # Valid: File path or null (disabled)
  # Default: null (no file logging)
  # Example: ./logs/curateur.log
  file: null

runtime:
  # Enable dry-run mode (simulation)
  # Purpose: Scan ROMs and query API without downloading media
  # Valid: true | false
  # Default: false
  # Note: Useful for testing configuration and estimating quota usage
  dry_run: false

search:
  # Enable search fallback when hash-based lookup fails
  # Purpose: Use jeuRecherche.php API to search by name when CRC lookup fails
  # Valid: true | false
  # Default: false
  # Note: Searches use filename without extension, may consume more API quota
  enable_search_fallback: false
  
  # Minimum confidence score to accept search match (0.0-1.0)
  # Purpose: Prevent false positives by requiring confidence threshold
  # Valid: 0.0 - 1.0 (0.7 = 70% confidence)
  # Default: 0.7
  # Note: Scoring factors: filename (40%), region (30%), size (15%), media (10%), rating (5%)
  confidence_threshold: 0.7
  
  # Maximum search results to consider
  # Purpose: Limit API response size and processing time
  # Valid: 1-10 (ScreenScraper typically returns 1-5 results)
  # Default: 5
  max_results: 5
  
  # Enable interactive prompts for search matches
  # Purpose: Allow user to select correct match from candidates
  # Valid: true | false
  # Default: false
  # Note: Prompts shown sequentially (thread-safe), displays confidence scores
  #       Requires terminal interaction, incompatible with fully automated workflows
  interactive_search: false
