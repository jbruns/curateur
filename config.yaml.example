# curateur configuration template
# Copy this file to config.yaml and customize each section as needed.

screenscraper:
  # ScreenScraper user credentials (required - obtain from screenscraper.fr)
  user_id: ""
  user_password: ""

paths:
  # Root ROM directory (can be absolute or relative)
  # Purpose: Source directory containing ROM files to scrape
  roms: ./roms
  
  # Destination for downloaded media (must be writable)
  # Purpose: Media files organized by system/media_type/filename
  # Default: ./downloaded_media
  media: ./downloaded_media
  
  # Destination for gamelist.xml files (must be writable)
  # Purpose: Generated gamelist.xml per system, ES-DE compatible
  # Default: ./gamelists
  gamelists: ./gamelists
  
  # Path to ES-DE es_systems.xml (must exist and be readable)
  # Purpose: Defines systems, extensions, and ROM paths for scanning
  # Default: ./es_systems.xml
  es_systems: ./es_systems.xml

scraping:
  # Scrape mode for ROM metadata and media
  # Purpose: Controls when to fetch data from API based on ROM changes
  # Valid: new_only | changed | force | skip
  # Default: changed
  # Behavior:
  #   - new_only: Only scrape ROMs not in gamelist (incremental additions)
  #               Ignores existing ROMs entirely, no media validation
  #   - changed: Scrape new/changed ROMs (hash mismatch), validate media on unchanged ROMs
  #              Efficient for maintaining collection: updates + validation
  #   - force: Re-scrape all ROMs regardless of changes (full refresh)
  #            Downloads all metadata and media from scratch
  #   - skip: Skip all metadata operations, only validate media
  #           Pure media validation mode (requires validation_mode enabled)
  scrape_mode: changed

  # System short names to scrape (e.g., ["nes","snes","psx"])
  # Purpose: Limits scraping to specific systems
  # Valid: ES-DE system short names from es_systems.xml
  # Default: [] (empty = all systems)
  systems: []
  
  # Region priority for media selection (lowercase ScreenScraper codes)
  # Purpose: Defines region preference when multiple media variants exist
  # Valid: us, wor (world), eu, jp, ss (ScreenScraper generic), and more
  # Default: [us, wor, eu, jp, ss]
  preferred_regions: [us, wor, eu, jp, ss]
  
  # Preferred metadata language (two-letter ISO 639-1 code)
  # Purpose: Language for game titles, descriptions, genres
  # Valid: en, fr, de, es, it, pt, ja, etc.
  # Default: en
  preferred_language: en
  
  # Gamelist integrity threshold (fraction of ROMs that must match)
  # Purpose: Fail validation if match rate below this threshold
  # Valid: 0.0 - 1.0 (0.95 = 95%)
  # Default: 0.95
  # Note: Validation always performed; prompt if threshold not met
  gamelist_integrity_threshold: 0.95
    
  # Metadata merge strategy for updates
  # Purpose: Controls how scraped data merges with existing gamelist entries
  # Valid: preserve_user_edits | refresh_metadata | reset_all
  # Default: preserve_user_edits
  # Behavior:
  #   - preserve_user_edits: Keep ALL existing fields unchanged, update only path (safest)
  #   - refresh_metadata: Update curateur fields (name, desc, rating, favorite, etc.), preserve all others
  #   - reset_all: Complete reset to API data + path only (discards user fields, custom fields)
  # Note: Cache updates handled separately by scrape_mode setting
  merge_strategy: preserve_user_edits
  
  # Auto-favorite based on rating threshold
  # Purpose: Automatically set favorite=true for highly-rated games
  # Valid: true | false
  # Default: false
  # Note: Only applies in refresh_metadata and reset_all modes
  auto_favorite_enabled: false
  
  # Rating threshold for auto-favorite
  # Purpose: Minimum rating (0.0-1.0) to trigger auto-favorite
  # Valid: 0.0 - 1.0 (0.9 = 90% rating)
  # Default: 0.9
  # Note: ScreenScraper ratings are normalized to 0.0-1.0 scale
  auto_favorite_threshold: 0.9

  # Auto-generate sortname for games with articles
  # Purpose: Automatically generate sortname field for games starting with A/An/The
  # Valid: true | false
  # Default: false
  # Example: "The Game Name Here" -> sortname: "Game Name Here, The"
  # Note: Helps with alphabetical sorting in ES-DE frontend
  auto_sortname_enabled: false

  # Name verification strictness
  # Purpose: How strictly to match game names during API verification
  # Valid: strict | normal | lenient | disabled
  # Default: normal
  # Note: strict=exact, normal=normalized, lenient=fuzzy, disabled=skip check
  name_verification: normal

  # Filter multi-disc entries on systems without M3U support
  # Purpose: Only create gamelist entry for Disc 1 when system doesn't support M3U
  # Valid: true | false
  # Default: false
  # Note: Systems with .m3u support are unaffected (M3U playlists handle multi-disc)
  filter_non_disc1: false

media:
  # Media types to download
  # Purpose: Defines which media assets to download from ScreenScraper
  # Valid: covers, screenshots, titlescreens, marquees, 3dboxes, backcovers,
  #        fanart, manuals, miximages, physicalmedia, videos
  # Default: all types
  # Note: Order does not affect download priority
  media_types:
    - covers
    - screenshots
    - titlescreens
    - marquees
    - 3dboxes
    - backcovers
    - fanart
    - manuals
    - miximages
    - physicalmedia
    - videos
  
  # Media validation mode
  # Purpose: Controls integrity checks performed on downloaded media
  # Valid: disabled | normal | strict
  # Default: disabled
  # Behavior:
  #   - disabled: Skip existing media files, no validation (fastest)
  #   - normal: Check image dimensions and content-type headers
  #   - strict: Full validation with file hashes, content headers, and dimensions
  #             Re-download files without cached hashes (exhaustive but slower)
  # Note: All modes store hashes in cache for future validation runs
  validation_mode: disabled

  # Minimum width/height (pixels) for image verification
  # Purpose: Reject images smaller than this dimension (applies in normal and strict modes)
  # Valid: Positive integer
  # Default: 50
  # Note: Prevents corrupt or placeholder images
  image_min_dimension: 50

  # Remove media files for disabled media types
  # Purpose: Clean up media when media_types list changes
  # Valid: true | false
  # Default: false
  # Note: Removes media types not in enabled media_types list
  clean_mismatched_media: false

api:
  # HTTP request timeout (seconds)
  # Purpose: Maximum time to wait for API responses
  # Valid: Positive number (15-60 recommended)
  # Default: 30
  request_timeout: 30
  
  # Maximum retry attempts for transient failures
  # Purpose: Auto-retry on network errors, 5xx responses
  # Valid: Non-negative integer (0-5 recommended)
  # Default: 3
  max_retries: 3
  
  # Base delay (seconds) for exponential backoff
  # Purpose: Initial wait time before retry (doubles each attempt)
  # Valid: Non-negative number (1-10 recommended)
  # Default: 5
  # Note: Retry delays: 5s, 10s, 20s with backoff_factor=2
  retry_backoff_seconds: 5
  
  # Quota warning threshold
  # Purpose: Log warning when approaching API quota limits (daily requests or bad requests)
  # Valid: 0.0 - 1.0 (0.95 = warn at 95% usage)
  # Default: 0.95
  # Note: Warning logged once per session when threshold crossed for either quota type
  quota_warning_threshold: 0.95

logging:
  # Logging level
  # Purpose: Controls verbosity of log output
  # Valid: DEBUG | INFO | WARNING | ERROR
  # Default: INFO
  # Note: DEBUG shows all operations, ERROR shows failures only
  level: INFO
  
  # Enable console logging
  # Purpose: Output logs to stdout/stderr
  # Valid: true | false
  # Default: true
  console: true
  
  # Optional log file path
  # Purpose: Write logs to file in addition to console
  # Valid: File path or null (disabled)
  # Default: null (no file logging)
  # Example: ./logs/curateur.log
  file: null

runtime:
  # Enable dry-run mode (simulation)
  # Purpose: Scan ROMs and query API without downloading media
  # Valid: true | false
  # Default: false
  # Note: Useful for testing configuration and estimating quota usage
  dry_run: false
  
  # Hash algorithm for ROM and media file verification
  # Purpose: Algorithm used to calculate and compare file hashes
  # Valid: crc32 | md5 | sha1
  # Default: crc32
  # Note: Stored in gamelist.xml <hash> element for change detection
  hash_algorithm: crc32
  
  # Maximum ROM file size (bytes) for hash calculation
  # Purpose: Skip ROM hash calculation for files larger than this (performance)
  # Valid: Non-negative integer (0 = disabled, calculate all files)
  # Default: 1073741824 (1 GiB)
  # Note: Large ISO/CHD ROM files may be slow to hash; does not apply to media files
  crc_size_limit: 1073741824
  
  # Enable API response cache
  # Purpose: Cache API responses to avoid re-querying for unchanged ROMs
  # Valid: true | false
  # Default: true
  # Note: If false, existing cache is ignored (not deleted) and no new entries are added
  #       Use --clear-cache flag to delete cache for systems in scope
  enable_cache: true
  
  # Advanced: Rate limit override (use with caution)
  # Purpose: Override API-provided rate limits for advanced scenarios
  # Valid: true | false
  # Default: false
  # Warning: Cannot exceed API limits - will be capped with warning
  # Note: API limits are authoritative; overrides can only reduce limits safely
  rate_limit_override_enabled: false
  
  # Rate limit override values (only used if rate_limit_override_enabled=true)
  # Purpose: Manually specify rate limits (capped at API-provided limits)
  # Valid: max_workers (1-10), requests_per_minute (1-300), daily_quota (1000-50000)
  # Default: API-provided limits, or 1 worker/60 rpm/10000 daily if API doesn't provide
  # Behavior: Values exceeding API limits will be capped with warning logged
  #           Values below API limits will be honored with warning logged
  rate_limit_override:
    max_workers: 1                # Concurrent workers (typical API: 4, max: 8)
    requests_per_minute: 60       # API calls per minute (typical API: 120-300)
    daily_quota: 10000            # Daily API call limit (typical API: 20000)

search:
  # Enable search fallback when hash-based lookup fails
  # Purpose: Use jeuRecherche.php API to search by name when CRC lookup fails
  # Valid: true | false
  # Default: false
  # Note: Searches use filename without extension, may consume more API quota
  enable_search_fallback: false
  
  # Minimum confidence score to accept search match (0.0-1.0)
  # Purpose: Prevent false positives by requiring confidence threshold
  # Valid: 0.0 - 1.0 (0.7 = 70% confidence)
  # Default: 0.7
  # Note: Scoring factors: filename (40%), region (30%), size (15%), media (10%), rating (5%)
  confidence_threshold: 0.7
  
  # Maximum search results to consider
  # Purpose: Limit API response size and processing time
  # Valid: 1-10 (ScreenScraper typically returns 1-5 results)
  # Default: 5
  max_results: 5
  
  # Enable interactive prompts for search matches
  # Purpose: Allow user to select correct match from candidates
  # Valid: true | false
  # Default: false
  # Note: Prompts shown sequentially (thread-safe), displays confidence scores
  #       Requires terminal interaction, incompatible with fully automated workflows
  interactive_search: false
