#!/usr/bin/env bash
# Pre-commit hook to check for file corruption and code quality issues
#
# Install this hook by copying to .git/hooks/pre-commit and making it executable:
#   cp .git-hooks/pre-commit .git/hooks/pre-commit
#   chmod +x .git/hooks/pre-commit

set -e

echo "Running code quality checks..."

# Get list of Python files being committed
PYTHON_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.py$' || true)

if [ -z "$PYTHON_FILES" ]; then
    echo "No Python files to check"
    exit 0
fi

# Run corruption check on staged Python files
for file in $PYTHON_FILES; do
    if [ -f "$file" ]; then
        python3 curateur/tools/code_quality_check.py "$file" || {
            echo "❌ Code quality check failed for $file"
            echo "Fix the issues above or use 'git commit --no-verify' to skip checks"
            exit 1
        }
    fi
done

echo "✅ All checks passed"
exit 0
